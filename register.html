<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册 - 实验室设备管理系统</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/fontawesome/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div class="login-container">
        <div class="login-card" style="max-width: 500px;">
            <div class="logo"><i class="fas fa-flask"></i></div>
            <h2>用户注册</h2>
            <form id="registerForm">
                <div class="mb-3">
                    <label class="form-label">用户类型</label>
                    <select class="form-control" id="userType" required>
                        <option value="">请选择身份类型</option>
                        <option value="teacher">校内教师</option>
                        <option value="student">校内学生</option>
                        <option value="external">校外人员</option>
                    </select>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">用户名</label>
                        <input type="text" class="form-control" id="username" placeholder="用于登录" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">真实姓名</label>
                        <input type="text" class="form-control" id="realName" placeholder="请输入真实姓名" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">密码</label>
                        <input type="password" class="form-control" id="password" placeholder="至少6位" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">确认密码</label>
                        <input type="password" class="form-control" id="confirmPassword" placeholder="再次输入密码" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">联系电话</label>
                    <input type="tel" class="form-control" id="phone" placeholder="手机号码">
                </div>

                <!-- 教师专属字段 -->
                <div id="teacherFields" style="display:none;">
                    <hr>
                    <h6 class="text-muted mb-3"><i class="fas fa-chalkboard-teacher me-2"></i>教师信息</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">职称</label>
                            <select class="form-control" id="title">
                                <option value="讲师">讲师</option>
                                <option value="副教授">副教授</option>
                                <option value="教授">教授</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">所属学院</label>
                            <input type="text" class="form-control" id="teacherCollege" placeholder="如：计算机学院">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">研究方向</label>
                        <input type="text" class="form-control" id="researchArea" placeholder="如：物联网技术">
                    </div>
                </div>

                <!-- 学生专属字段 -->
                <div id="studentFields" style="display:none;">
                    <hr>
                    <h6 class="text-muted mb-3"><i class="fas fa-user-graduate me-2"></i>学生信息</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">学号</label>
                            <input type="text" class="form-control" id="studentNo" placeholder="如：S2024001">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">专业</label>
                            <input type="text" class="form-control" id="major" placeholder="如：软件工程">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">所属学院</label>
                            <input type="text" class="form-control" id="studentCollege" placeholder="如：计算机学院">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">导师 ID (可选)</label>
                            <input type="number" class="form-control" id="advisorId" placeholder="请输入导师 ID">
                        </div>
                    </div>
                </div>

                <!-- 校外人员专属字段 -->
                <div id="externalFields" style="display:none;">
                    <hr>
                    <h6 class="text-muted mb-3"><i class="fas fa-building me-2"></i>校外人员信息</h6>
                    <div class="mb-3">
                        <label class="form-label">所在单位</label>
                        <input type="text" class="form-control" id="organization" placeholder="公司/机构名称">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">身份证号</label>
                        <input type="text" class="form-control" id="identityCard" placeholder="用于身份核验">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-4" id="regBtn">注 册</button>
            </form>
            <div class="text-center mt-4">
                <a href="index.html" class="text-muted"><i class="fas fa-arrow-left me-1"></i>返回登录</a>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script>
        const userTypeSelect = document.getElementById('userType');
        const teacherFields = document.getElementById('teacherFields');
        const studentFields = document.getElementById('studentFields');
        const externalFields = document.getElementById('externalFields');

        userTypeSelect.addEventListener('change', function () {
            teacherFields.style.display = 'none';
            studentFields.style.display = 'none';
            externalFields.style.display = 'none';

            switch (this.value) {
                case 'teacher':
                    teacherFields.style.display = 'block';
                    break;
                case 'student':
                    studentFields.style.display = 'block';
                    break;
                case 'external':
                    externalFields.style.display = 'block';
                    break;
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const regBtn = document.getElementById('regBtn');
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                UI.showToast('两次密码输入不一致', 'error');
                return;
            }
            if (password.length < 6) {
                UI.showToast('密码至少6位', 'error');
                return;
            }

            const userType = userTypeSelect.value;
            const data = {
                username: document.getElementById('username').value,
                password: password,
                real_name: document.getElementById('realName').value,
                user_type: userType,
                phone: document.getElementById('phone').value
            };

            // 添加角色专属字段
            if (userType === 'teacher') {
                data.title = document.getElementById('title').value;
                data.college = document.getElementById('teacherCollege').value;
                data.research_area = document.getElementById('researchArea').value;
            } else if (userType === 'student') {
                data.student_no = document.getElementById('studentNo').value;
                data.major = document.getElementById('major').value;
                data.college = document.getElementById('studentCollege').value;
                data.advisor_id = document.getElementById('advisorId').value;
            } else if (userType === 'external') {
                data.organization = document.getElementById('organization').value;
                data.identity_card = document.getElementById('identityCard').value;
            }

            regBtn.disabled = true;
            regBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 注册中...';

            try {
                const result = await API.post('register.php', data);
                if (result.code === 0) {
                    UI.showToast('注册成功！请登录');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                } else {
                    UI.showToast(result.message || '注册失败', 'error');
                }
            } catch (error) {
                UI.showToast('网络请求失败', 'error');
            } finally {
                regBtn.disabled = false;
                regBtn.innerHTML = '注 册';
            }
        });
    </script>
</body>

</html>