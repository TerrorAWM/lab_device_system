<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备详情 - 实验室设备管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <nav class="top-navbar">
            <div class="brand"><i class="fas fa-flask me-2"></i>实验室设备管理系统</div>
            <div class="user-info">
                <span id="userName">用户</span>
                <div class="avatar"><i class="fas fa-user"></i></div>
            </div>
        </nav>
        <div class="d-flex">
            <aside class="sidebar">
                <a href="device_list.html" class="nav-item active"><i class="fas fa-desktop"></i>设备列表</a>
                <a href="reservation.html" class="nav-item"><i class="fas fa-calendar-check"></i>我的预约</a>
                <a href="borrow.html" class="nav-item"><i class="fas fa-hand-holding"></i>借用记录</a>
                <a href="payment.html" class="nav-item"><i class="fas fa-credit-card"></i>缴费中心</a>
                <a href="profile.html" class="nav-item"><i class="fas fa-user-circle"></i>个人中心</a>
            </aside>
            <main class="content-area">
                <div class="page-header">
                    <a href="device_list.html" class="text-muted"><i class="fas fa-arrow-left me-2"></i>返回列表</a>
                    <h1 class="mt-2" id="deviceName">设备详情</h1>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <div class="card">
                            <div class="device-image" style="height:250px"><i class="fas fa-microchip"
                                    style="font-size:80px"></i></div>
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="card">
                            <div class="card-body">
                                <table class="table">
                                    <tr>
                                        <th width="100">型号</th>
                                        <td id="deviceModel"></td>
                                    </tr>
                                    <tr>
                                        <th>分类</th>
                                        <td id="deviceCategory"></td>
                                    </tr>
                                    <tr>
                                        <th>位置</th>
                                        <td id="deviceLocation"></td>
                                    </tr>
                                    <tr>
                                        <th>日租金</th>
                                        <td id="devicePrice"></td>
                                    </tr>
                                    <tr>
                                        <th>状态</th>
                                        <td id="deviceStatus"></td>
                                    </tr>
                                </table>
                                <button class="btn btn-primary w-100" id="reserveBtn"
                                    onclick="App.openModal('reserveModal')">
                                    <i class="fas fa-calendar-plus me-2"></i>立即预约
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <div class="modal-overlay" id="reserveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>预约设备</h3><button class="modal-close" onclick="App.closeModal('reserveModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="reserveForm">
                    <div class="form-group"><label class="form-label">开始日期</label><input type="date"
                            class="form-control" id="startDate" required></div>
                    <div class="form-group"><label class="form-label">结束日期</label><input type="date"
                            class="form-control" id="endDate" required></div>
                    <div class="form-group"><label class="form-label">借用原因</label><textarea class="form-control"
                            id="reason" rows="3" required></textarea></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="App.closeModal('reserveModal')">取消</button>
                <button class="btn btn-primary" onclick="submitReserve()">提交预约</button>
            </div>
        </div>
    </div>
    <script src="../js/data.js"></script>
    <script src="../js/app.js"></script>
    <script>
        const user = App.checkAuth();
        const params = new URLSearchParams(window.location.search);
        const deviceId = params.get('id');
        if (user && deviceId) {
            document.getElementById('userName').textContent = user.username;
            const device = DataService.getDevice(deviceId);
            if (device) {
                document.getElementById('deviceName').textContent = device.name;
                document.getElementById('deviceModel').textContent = device.model;
                document.getElementById('deviceCategory').textContent = device.category;
                document.getElementById('deviceLocation').textContent = device.location;
                document.getElementById('devicePrice').textContent = `¥${device.price}/天`;
                document.getElementById('deviceStatus').innerHTML = App.renderStatusBadge(MockData.deviceStatus[device.status]);
                if (device.status !== 0) { document.getElementById('reserveBtn').disabled = true; document.getElementById('reserveBtn').textContent = '暂不可预约'; }
            }
        }
        function submitReserve() {
            const data = { deviceId: parseInt(deviceId), startDate: document.getElementById('startDate').value, endDate: document.getElementById('endDate').value, reason: document.getElementById('reason').value };
            if (!data.startDate || !data.endDate || !data.reason) { App.showToast('请填写完整信息', 'error'); return; }
            DataService.createReservation(data);
            App.showToast('预约申请已提交！');
            App.closeModal('reserveModal');
            setTimeout(() => App.navigate('reservation.html'), 1000);
        }
    </script>
</body>

</html>