<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备管理 - 管理后台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <nav class="top-navbar">
            <div class="brand"><i class="fas fa-cogs me-2"></i>管理后台</div>
            <div class="user-info"><span id="adminName">管理员</span>
                <div class="avatar"><i class="fas fa-user-shield"></i></div>
            </div>
        </nav>
        <div class="d-flex">
            <aside class="sidebar">
                <a href="dashboard.html" class="nav-item"><i class="fas fa-tachometer-alt"></i>仪表盘</a>
                <a href="device.html" class="nav-item active"><i class="fas fa-desktop"></i>设备管理</a>
                <a href="reservation.html" class="nav-item"><i class="fas fa-calendar-check"></i>预约审批</a>
                <a href="borrow.html" class="nav-item"><i class="fas fa-hand-holding"></i>借用管理</a>
                <a href="payment.html" class="nav-item"><i class="fas fa-credit-card"></i>收费管理</a>
                <a href="user.html" class="nav-item"><i class="fas fa-users"></i>用户管理</a>
                <a href="maintenance.html" class="nav-item"><i class="fas fa-wrench"></i>设备检修</a>
                <a href="reports.html" class="nav-item"><i class="fas fa-chart-bar"></i>统计报表</a>
            </aside>
            <main class="content-area">
                <div class="page-header d-flex justify-content-between align-items-center">
                    <h1>设备管理</h1>
                    <button class="btn btn-primary" onclick="openAddModal()"><i
                            class="fas fa-plus me-2"></i>添加设备</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>设备名称</th>
                                    <th>型号</th>
                                    <th>分类</th>
                                    <th>位置</th>
                                    <th>日租金</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="deviceList"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <div class="modal-overlay" id="deviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">添加设备</h3><button class="modal-close"
                    onclick="App.closeModal('deviceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="deviceForm">
                    <input type="hidden" id="deviceId">
                    <div class="form-group"><label class="form-label">设备名称</label><input type="text"
                            class="form-control" id="deviceName" required></div>
                    <div class="form-group"><label class="form-label">型号</label><input type="text" class="form-control"
                            id="deviceModel" required></div>
                    <div class="form-group"><label class="form-label">分类</label><select class="form-control"
                            id="deviceCategory">
                            <option>测量仪器</option>
                            <option>信号源</option>
                            <option>电源设备</option>
                            <option>分析仪器</option>
                        </select></div>
                    <div class="form-group"><label class="form-label">位置</label><input type="text" class="form-control"
                            id="deviceLocation" required></div>
                    <div class="form-group"><label class="form-label">日租金(元)</label><input type="number"
                            class="form-control" id="devicePrice" required></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="App.closeModal('deviceModal')">取消</button>
                <button class="btn btn-primary" onclick="saveDevice()">保存</button>
            </div>
        </div>
    </div>
    <script src="../js/data.js"></script>
    <script src="../js/app.js"></script>
    <script>
        const admin = App.checkAdminAuth();
        if (admin) {
            document.getElementById('adminName').textContent = admin.name + ' (' + App.getAdminRoleName(admin.role) + ')';
            App.renderAdminSidebar(admin.role, 'device');
            render();
        }
        function render() {
            document.getElementById('deviceList').innerHTML = MockData.devices.map(d => `
                <tr>
                    <td>${d.name}</td><td>${d.model}</td><td>${d.category}</td><td>${d.location}</td><td>¥${d.price}</td>
                    <td>${App.renderStatusBadge(MockData.deviceStatus[d.status])}</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="editDevice(${d.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteDevice(${d.id})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }
        function openAddModal() { document.getElementById('modalTitle').textContent = '添加设备'; document.getElementById('deviceForm').reset(); document.getElementById('deviceId').value = ''; App.openModal('deviceModal'); }
        function editDevice(id) {
            const d = DataService.getDevice(id);
            document.getElementById('modalTitle').textContent = '编辑设备';
            document.getElementById('deviceId').value = d.id;
            document.getElementById('deviceName').value = d.name;
            document.getElementById('deviceModel').value = d.model;
            document.getElementById('deviceCategory').value = d.category;
            document.getElementById('deviceLocation').value = d.location;
            document.getElementById('devicePrice').value = d.price;
            App.openModal('deviceModal');
        }
        function saveDevice() {
            const data = { name: document.getElementById('deviceName').value, model: document.getElementById('deviceModel').value, category: document.getElementById('deviceCategory').value, location: document.getElementById('deviceLocation').value, price: parseInt(document.getElementById('devicePrice').value) };
            const id = document.getElementById('deviceId').value;
            if (id) DataService.updateDevice(parseInt(id), data); else DataService.addDevice(data);
            App.closeModal('deviceModal'); App.showToast('保存成功！'); render();
        }
        function deleteDevice(id) { if (confirm('确定删除该设备？')) { DataService.deleteDevice(id); App.showToast('删除成功'); render(); } }
    </script>
</body>

</html>