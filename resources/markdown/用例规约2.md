# 用例规约 2：预约申请审批（覆盖教师/学生/校外差异链）

## 1) 用例基本信息

* **用例编号**：UC-02
* **用例名称**：预约申请审批
* **主要参与者（Primary Actor）**：设备管理员（管理员审批阶段）
* **其他参与者（Secondary Actor）**：指导教师（学生审批阶段）、实验室负责人（校外终审阶段）、学校财务系统（校外缴费确认）
* **用例目标**：按规则完成预约审批并更新预约台账状态：

  * 教师：管理员审批通过即生效；
  * 学生：教师先批→管理员再批（含师生关系核验）；
  * 校外：管理员先批→负责人终审→缴费确认→管理员最终确认。

## 2) 触发条件（Trigger）

审批人登录后进入“预约申请审批/待办”，选择某条待审批预约执行审批。

## 3) 前置条件（Preconditions）

1. 系统已有“待审批/待教师审批/待管理员审批/待负责人审批/待缴费确认”等状态的预约记录。
2. 设备台账、人员台账、学生-导师关系数据可被查询核验（用于管理员核验与可用性核查）。

## 4) 后置条件（Postconditions）

* 成功：预约状态更新为“已批准/已生效”，并记录审批信息；必要时记录收费确认结果。&#x20;
* 失败：预约状态为“已驳回/已撤销/待补充材料”等，并记录驳回原因。

## 5) 业务规则关联（强绑定）

* 教师：管理员批准即可；学生：教师先批再管理员批；校外：管理员先批再负责人批。
* 审批时必须核查设备在申请时段内是否可用（检修时段不可用；冲突时校内优先）。&#x20;
* 校外缴费：审批通过后需到财务处缴费并获得确认，系统要求与财务系统自动对接回传确认。&#x20;

## 6) 基本事件流（以“校内教师预约审批成功”为最简主场景）

1. **设备管理员**进入“待审批预约列表”，选择一条预约。
2. 系统展示预约详情：设备、申请人、申请时段、用途等。
3. 设备管理员执行“设备可用性核查”：该设备在申请时段是否可用（不在检修时段、无冲突）。&#x20;
4. 若可用，管理员点击“批准”，系统：

   * 写入审批人/审批时间/审批意见；
   * 更新预约台账状态为“已批准/已生效”；
   * 更新设备预约状态。&#x20;
5. 系统通知申请人审批结果。
6. 用例结束。

## 7) 备选/扩展事件流（覆盖学生与校外的关键差异）

### A1 学生预约审批（两级审批）

* A1-1【指导教师审批】

  1. 指导教师打开待审批预约 → 查看详情 → 批准/驳回。
  2. 若教师批准：系统将预约状态改为“待管理员审批”，推送给设备管理员。
  3. 若教师驳回：预约状态=已驳回，结束。

* A1-2【设备管理员审批】
  4. 管理员接到“待管理员审批”的学生预约。
  5. 管理员先核验“学生-该指导教师关系是否有效”，无效则驳回。
  6. 关系有效后再做设备可用性核查；可用则批准并生效。

### A2 校外人员预约审批（两级审批+缴费确认+管理员最终确认）

1. 校外人员预约先到设备管理员审批：管理员核查设备可用性，可用则先批准并流转给实验室负责人终审。
2. 实验室负责人审批：通过则进入“待缴费确认”状态；不通过则驳回。
3. 缴费确认：校外人员缴费后，财务系统回传缴费确认结果。&#x20;
4. 管理员收到“已缴费”状态后进行最终确认，记录设备预约状态后使预约生效。

### A3 可用性核查失败（设备冲突/检修）

* 管理员核查发现不可用：

  * 若申请人为校内（教师/学生），管理员可直接驳回或建议改期；
  * 若冲突发生在校内 vs 校外，按“校内优先”规则处理（校外可能被驳回或要求改期）。